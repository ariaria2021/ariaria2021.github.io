---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const sortedPosts = allPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout title="Blog" description="ブログ記事一覧">
  <section class="section">
    <div class="container container-narrow">
      <div class="page-header fade-in">
        <h1 class="gradient-text">Blog</h1>
        <p>技術記事や日々の学びを書いています</p>
      </div>
      
      <div class="posts-list">
        {sortedPosts.map((post) => (
          <a href={`/blog/${post.slug}`} class="post-item fade-in">
            <div class="post-meta">
              <time>{post.data.date.toLocaleDateString('ja-JP')}</time>
              {post.data.tags && (
                <div class="post-tags">
                  {post.data.tags.map((tag) => (
                    <span class="tag">{tag}</span>
                  ))}
                </div>
              )}
            </div>
            <h2 class="post-title">{post.data.title}</h2>
            <p class="post-description">{post.data.description}</p>
          </a>
        ))}
      </div>

      {sortedPosts.length === 0 && (
        <div class="empty-state">
          <p>まだ記事がありません。</p>
        </div>
      )}
    </div>
  </section>
</BaseLayout>

<style>
  .page-header {
    text-align: center;
    padding: var(--space-3xl) 0;
    border-bottom: 1px solid var(--color-border);
    margin-bottom: var(--space-2xl);
  }

  .page-header h1 {
    margin-bottom: var(--space-md);
  }

  .posts-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }

  .post-item {
    display: block;
    padding: var(--space-xl);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    text-decoration: none;
    transition: all var(--transition-base);
  }

  .post-item:hover {
    border-color: var(--color-border-hover);
    transform: translateX(4px);
  }

  .post-meta {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    margin-bottom: var(--space-sm);
  }

  .post-meta time {
    font-size: 0.75rem;
    color: var(--color-text-muted);
  }

  .post-tags {
    display: flex;
    gap: var(--space-xs);
  }

  .post-title {
    color: var(--color-text);
    font-size: 1.25rem;
    margin-bottom: var(--space-sm);
  }

  .post-description {
    font-size: 0.875rem;
    color: var(--color-text-secondary);
  }

  .empty-state {
    text-align: center;
    padding: var(--space-3xl);
    color: var(--color-text-muted);
  }
</style>
